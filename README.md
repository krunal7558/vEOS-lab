
#Arista vEOS lab
================

## vEOS-lab/

Notable files and directories:

* hosts: Ansible inventory file. 

* ansible.cfg: Ansible configuration file.

* group_vars/*: GRoup specific variable files.

* host_vars/*: Host specific variable files.

* templates/*: Platform specific Jinja2 templates to render over.

* tasks/*: Platform specific tasks which calls platform specific network modules.

* roles/*: currently empty.

* vars/*: Generic variable files. 

* configs/*: Configs file generated from teplate.

* backup/*: backup of running configs.

* outputs/*: show commands output files generated by netsnapshot.yml.

* library/*: list of support code e.g. python code, textfsm templates etc.

* vault/*: Encrypted files created using ansible-vault. 

## Prerequisites

Ensure you have Ansible 2.4 installed on your Linux server.

	pip install ansible

## Getting Started

### Step 1:

Clone repository on your home directory

	$ git clone https://github.com/krunal7558/vEOS-lab
	Cloning into 'vEOS-lab'...
	remote: Counting objects: 12, done.
	remote: Compressing objects: 100% (10/10), done.
	remote: Total 12 (delta 1), reused 7 (delta 0), pack-reused 0
	Unpacking objects: 100% (12/12), done.
	Checking connectivity... done.


### Step 2:

You would need .box vagrant VM image for vEOS to be placed in vEOS-lab directory. This file is not included with repository

	$ cd vEOS-lab/
	/vEOS-lab $ ls -la
	-rw-rw-r-- 1 krunal krunal 933341884 Sep 15 21:47 vEOS-lab-4.18.1F-virtualbox.box

### Step 3:

Add virtual box 

	/vEOS-lab $ vagrant box add vEOS-lab-4.18.1F vEOS-lab-4.18.1F-virtualbox.box
	/vEOS-lab $ vagrant box list
	vEOS-lab-4.18.1F (virtualbox, 0)
	/vEOS-lab $ vagrant init vEOS-lab-4.18.1F
	A `Vagrantfile` has been placed in this directory. You are now
	ready to `vagrant up` your first virtual environment! Please read
	the comments in the Vagrantfile as well as documentation on
	`vagrantup.com` for more information on using Vagrant.

### Step 4:

Check ''Vagrantfile'' and bring up environment. This will take ~10 mins. You may check full example output of 'vagrant up' in ``vagrantup.txt`` file

	/vEOS-lab $ vagrant up
	/vEOS-lab $ vagrant status
	Current machine states:
	spine01                   running (virtualbox)
	spine02                   running (virtualbox)
	leaf01                    running (virtualbox)
	leaf02                    running (virtualbox)
	leaf03                    running (virtualbox)
	leaf04                    running (virtualbox)

	This environment represents multiple VMs. The VMs are all listed
	above with their current state. For more information about a specific
	VM, run `vagrant status NAME`.

	Ignore SSH keys if needed:

	Add StrictHostKeyChecking=no to ~/.ssh/config or /etc/ssh/ssh_config to stop ssh client from complaining about ever-changing SSH keys on switches.
	/vEOS-lab $ echo StrictHostKeyChecking=no >> ~/.ssh/config


### Step 4:

Create vault file which holds all secret passwords e.g TACACS passwords and enable passwords

	$ mkdir vault
	$ cd vault
	$ ansible-vault create secret.yml
	New Vault password:
	Confirm New Vault password:

Remember this password. Inside secret.yml

Replace with your own tacacs username password

	---
	ansible_user: tacacsusername
	ansible_ssh_pass: topsecret
	enable_pass: everyoneknows
	# Ansible 2.5
	ansible_password: topsecret
	ansible_become_pass: everyoneknows

Save and exit this file can be edited only using "ansible-vault edit secret.yml" command


You are now ready to run playbooks.

### Example 1:

Take bunch of show commands from multiple devices. usefull to compare network state before and after maintenance

	$ vim ./vars/show_commands.yml

Add list of commands to capture save and exit, 
Any platform specific show commands can be added by creating show_commands.yml file under eos, ios or nxos folder

Run playbook using

	$ ansible-playbook -l cisco netsnapshot.yml --extra-vars 'commands_file=show_commands.yml'

### Example 2:

Inventory collections and fact gathering. 

	$ ansible-playbook gather_facts.yml


### Example 3:

Gather SSH keys of network devices and populate them in ~/ssh/known_hosts file.

	$ ansible-playbook get-sshkeys.yml


